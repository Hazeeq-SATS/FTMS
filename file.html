<!DOCTYPE html>
<html>
<head>
    <title>Bluetooth Device Connection Example</title>
</head>
<body>
    <button id="connectButton">Connect to Bluetooth Device</button>
    <div id="deviceInfo"></div>
    <div id="temperatureValue"></div>

    <script>
        document.getElementById('connectButton').addEventListener('click', function() {
            navigator.bluetooth.requestDevice({
                filters: [{ name: '21057150 RayTemp Blue' }],
                optionalServices: ['45544942-4c55-4554-4845-524db87ad700']
            })
            .then(device => {
                console.log('Device selected:', device.name);
                document.getElementById('deviceInfo').innerText = `Connected to device: ${device.name}`;
                return device.gatt.connect();
            })
            .then(server => {
                return server.getPrimaryService('45544942-4c55-4554-4845-524db87ad700');
            })
            .then(service => {
                return service.getCharacteristic('45544942-4c55-4554-4845-524db87ad701');
            })
            .then(characteristic => {
                // Subscribe to notifications
                characteristic.startNotifications().then(() => {
                    console.log('Subscribed to temperature notifications');
                    characteristic.addEventListener('characteristicvaluechanged', event => {
                        const value = event.target.value;
                        // Assuming the temperature data is a 32-bit float
                        // Adjust this based on your characteristic's actual data format
                        const temperature = value.getFloat32(0, true);
                        document.getElementById('temperatureValue').innerText = `Temperature: ${temperature}Â°C`;
                    });
                });
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('deviceInfo').innerText = `Connection error: ${error}`;
            });
        });
    </script>
</body>
</html>
